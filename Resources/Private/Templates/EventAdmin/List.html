{namespace extlist=Tx_PtExtlist_ViewHelpers}
{namespace ptextbase=Tx_PtExtbase_ViewHelpers}

<f:layout name="Default"/>


<f:section name="main">

	<h1>Veranstaltungen</h1>
	<ptextbase:flashMessages renderMode="div"
							 messageCssClasses="{0: 'alert alert-success', 1: 'alert alert-warning', 2: 'alert alert-error'}"/>
	<br/>
	<legend>Übersicht</legend>
	<table class="table table-striped">
		<tr>
			<f:render partial="EXT:jdav_sv/Resources/Private/Partials/Extlist/ListHeader.html"
					  arguments="{listHeader:listHeader, listCaptions:listCaptions}"/>
		</tr>
		<f:for each="{listData}" as="row">
			<tr>
				<td>
					<strong>{row.event.value.category.shortcut}-{row.event.value.accreditationNumber}</strong><br>

					<p class="btn {row.event.value.lights}" id="event-registrations-{row.event.value.uid}" data-original-title="Anmeldestand" data-content="{row.event.value.maxRegistrations} Plätze gesamt<br>{row.event.value.nonWaitingListRegistrationsCount} Anmeldungen (ohne Warteliste)<br>{row.event.value.waitingListRegistrationsCount} Wartelistenplätze">{row.event.value.registrationsCount} /
						{row.event.value.maxRegistrations}</p>
				</td>
				<td>{row.event.value.dateStart -> f:format.date(format: 'd.m.Y')}<br>
					{row.event.value.dateEnd -> f:format.date(format: 'd.m.Y')}
				</td>
				<td>
					<strong>{row.event.value.title}</strong>
					<f:if condition="{row.event.value.hasComments}">
						<i class="icon-tags" data-content="{row.event.value.comment}" data-original-title="Interne Notizen" id="event-comment-{row.event.value.uid}"></i>
					</f:if>
					<br>
					{row.event.value.subtitle}<br/>
					<f:link.action controller="EventAdmin" action="show" arguments="{event: row.event.value.uid}">
						Details
					</f:link.action>
					&nbsp;
					<f:link.action controller="Export" action="exportRegistrationsListForTeamers"
								   arguments="{event: row.event.value}">Teamer TN-Liste
					</f:link.action>
					&nbsp;
					<f:link.action controller="Export" action="exportRegistrationsListForParticipants"
								   arguments="{event: row.event.value}">Teilnehmer TN-Liste
					</f:link.action>
					&nbsp;
				</td>
				<td>
					<p class="pull-right">
						<f:link.action class="btn btn-primary" controller="EventAdmin" action="edit"
									   arguments="{event: row.event.value.uid}"><i class="icon-pencil icon-white"></i>
							Bearbeiten
						</f:link.action>
						<f:link.action class="btn btn-primary" controller="RegistrationAdmin" action="new"
									   arguments="{event: row.event.value.uid}"><i class="icon-plus icon-white"></i>
							Neue Anmeldung
						</f:link.action>
						<f:link.action class="btn btn-danger" controller="EventAdmin" action="delete"
									   arguments="{event: row.event.value.uid}"><i class="icon-trash icon-white"></i>
							Löschen
						</f:link.action>
					</p>
				</td>
			</tr>
		</f:for>
	</table>

	<div class="form-actions">
		<table>
			<tr>
				<td class="span4">
					<f:link.action class="btn btn-primary" action="new" class="btn btn-primary"><i class="icon-plus icon-white"></i>
						Neue Veranstaltung anlegen
					</f:link.action>
				</td>
				<td>
					<f:render partial="Extlist/Pager"
							  arguments="{pager: pager, pagerCollection: pagerCollection, item:'Veranstaltungen', action:'list'}"/>
				</td>
			</tr>
		</table>
	</div>

</f:section>

<f:section name="javascript">
	<script type="text/javascript">
		<f:for each="{listData}" as="row">

			<f:if condition="{row.event.value.hasComments}">
				$('#event-comment-{row.event.value.uid}').popover();
			</f:if>
			$('#event-registrations-{row.event.value.uid}').popover();

		</f:for>
	</script>
</f:section>